#!/usr/bin/env node
var fs = require('fs'),
    path = require('path');
var program = require('commander');
var package = require('../package');

process.chdir(__dirname + '/..');

var defaultConfigPath = path.normalize(path.join(__dirname, '..', 'config.js'));

program
  .version(package.version)
  .option('-c, --config <path>', 'config file path', defaultConfigPath)
  .parse(process.argv);

if (!fs.existsSync(program.config)) {
  console.error('ERROR: config not found at "%s"', program.config);
  process.exit(1);
}

var config = require(program.config);
var app = require('..')(config);
return app.start(function(err) {
  if (err) throw err;
  var address = app.http.address();
  console.log('transplant listening on %s:%s', address.address, address.port);
});
